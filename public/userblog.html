<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
    <title>Your History Blog</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <!-- <style type="text/css" media="all">
        @import "images/style.css";
    </style> -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="hashtag.css">
</head>

<body onload="getdata()">
  
    <div class="content">
        <div id="header">
            <div class="title">
                <h1>Your History Blog</h1>
           
              </div>
        </div>

        <div id="main">
            <div class="center">
                <form class="form_add_search">


                    <div class="add">

                        <button id="myBtn">add blog</button>
                    </div>
                </form>

                <div id="myModal" class="modal ">

                    <!-- Modal content -->
                    <div class="content">
                        <div id="header">
                            <div class="title">
                                <h1>Add Your Blog</h1>

                            </div>
                            <span class="close">&times;</span>
                            <form action="http://localhost:3000/user/addBlog" class="modal_form" method="post"
                                enctype="multipart/form-data">
                        </div>
                        <div id="main">
                            <div class="center center_form">
                                <div>
                                    <label for="image">add img</label>
                                    <input name="image" type="file" id="image" required>
                                </div>
                                <div>
                                    <label for="title">title</label>
                                    <input name="title" type="text" required>
                                </div>
                                <div>
                                    <label for="artical">artical</label>
                                    <textarea name="body" id="body" cols="30" rows="10" required></textarea>
                                </div>

                                <div class="inputTags">
                                    <label for="tags">tags</label>
                                    <!-- <input type="text" required> -->
                                    <div class="wrapper">
                                        <input name="tags" type="text" id="hashtags" autocomplete="on" required>
                                        <div class="tag-container">
                                        </div>
                                    </div>
                                </div>
                                <input type="submit" value="submit" style="cursor:pointer;"></input>
                            </div>
                        </div>

                        <div id="prefooter">
                        </div>
                        <div id="footer">
                            <div class="padding"> Copyright &copy; 2006 Your Site Name | Design: <a
                                    href="http://www.free-css-templates.com">David Herreman </a> | <a
                                    href="#">Contact</a> | <a
                                    href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> and <a
                                    href="http://validator.w3.org/check?uri=referer">XHTML</a> | <a
                                    href="http://www.solucija.com">Solucija.com</a> | <a href="#">Login</a> </div>
                        </div>
                        </form>

                    </div>

                </div>
                <div id="blogs">
                    <div id="editModal" class="modal ">

                        <!-- Modal content -->
                        <div class="content">
                            <div id="header">
                                <div class="title">
                                    <h1>Edit Your Blog Details</h1>

                                </div>
                                <span class="close" id="ClosupdateBlog">&times;</span>
                            </div>
                            <div id="main">
                                <div class="center center_form">
                                    <div>
                                        <label for="image">Edit img</label>
                                        <input name="Blogimage" type="file" id="Blogimage">
                                    </div>
                                    <div>
                                        <label for="title">Edit title</label>
                                        <input name="title" type="text" id="title" required>
                                    </div>
                                    <div>
                                        <label for="artical">Edit artical</label>
                                        <textarea id="blogbody" cols="30" rows="10" required></textarea>
                                    </div>
                                    <button type="submit" value="Submit" id="bt">Submit</button>
                                </div>
                            </div>

                            <div id="prefooter">
                            </div>
                            <div id="footer">
                                <div class="padding"> Copyright &copy; 2006 Your Site Name | Design: <a
                                        href="http://www.free-css-templates.com">David Herreman </a> | <a
                                        href="#">Contact</a> | <a
                                        href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> and <a
                                        href="http://validator.w3.org/check?uri=referer">XHTML</a> | <a
                                        href="http://www.solucija.com">Solucija.com</a> | <a href="#">Login</a> </div>
                            </div>

                        </div>

                    </div>

                </div>
            
              

            </div>
            <div class="leftmenu">
                <div class="nav">
                    <ul>
                        <li><a href="home">Home</a></li>
                        <li><a href="userblog">Blog</a></li>
                        <li><a href="profile">Profile</a></li>
                        <li><a href="logout" ">Logout</a></li>

                    </ul>
                </div>
            </div>
        </div>

        <div id="prefooter">
        </div>
        <div id="footer">
            <div class="padding"> Copyright &copy; 2006 Your Site Name | Design: <a
                    href="http://www.free-css-templates.com">David Herreman </a> | <a href="#">Contact</a> | <a
                    href="http://jigsaw.w3.org/css-validator/check/referer">CSS</a> and <a
                    href="http://validator.w3.org/check?uri=referer">XHTML</a> | <a
                    href="http://www.solucija.com">Solucija.com</a> | <a href="#">Login</a> </div>
        </div>


</body>

<script>

    // Get the modal
    var modal = document.getElementById("myModal");

    // Get the button that opens the modal
    var btn = document.getElementById("myBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal 
    btn.onclick = function (event) {
        modal.style.display = "block";
        event.preventDefault()
        document.body.style.backdropFilter = 'blur(10px)'

    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
        document.body.style.backdropFilter = 'brightness(0.5)'

    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }


    // HashTag Input ::

    let input, hashtagArray, container, t;

    input = document.querySelector('#hashtags');
    container = document.querySelector('.tag-container');
    hashtagArray = [];

    input.addEventListener('keyup', () => {
        if (event.which == 13 && input.value.length > 0) {
            var text = document.createTextNode(input.value);
            var p = document.createElement('p');
            container.appendChild(p);
            p.appendChild(text);
            p.classList.add('tag');
            input.value = '';

            let deleteTags = document.querySelectorAll('.tag');

            for (let i = 0; i < deleteTags.length; i++) {
                deleteTags[i].addEventListener('click', () => {
                    container.removeChild(deleteTags[i]);
                });
            }
        }
    });

    // Get Text Node From Hashtags
//  const form = document.querySelector('tag'); // replace with your form selector
// const iterator = document.createNodeIterator(form, NodeFilter.SHOW_TEXT);

// let node;
// while (node = iterator.nextNode()) {
//   console.log(node.textContent);
// }







    // *****************************************************************************
    // Fetch Data  : 


    function getdata() {

        fetch('http://localhost:3000/user/getUserBlogs').then(function (res) {

            return res.json();
        }).then(function (blogs) {

            console.log(blogs);
            blogs.forEach(blog => {

                console.log(blog._id);
                let blogs = document.getElementById('blogs')
                let blogsContainer = document.createElement('div')
                blogsContainer.className = 'dis_flex'
                // Blog Content
                let blogsDescription = document.createElement('p')
                blogsDescription.className = 'dis_flex_p'
                blogsDescription.innerText = blog.body
                // Blog Title  :
                let blogsTitleContainer = document.createElement('div')
                let blogsTitle = document.createElement('h2')
                blogsTitle.className = 'blogTitle'
                blogsTitle.innerText = blog.title
                blogsTitleContainer.appendChild(blogsTitle)

                // Blog Img
                let blogsImg = document.createElement('img')
                blogsImg.className = 'blogImg'
                blogsImg.setAttribute("src", blog.image);
                let blogImgDiv = document.createElement('div')
                blogImgDiv.className = 'imgContainer'
                // Blog Info 
                let blogsInfo = document.createElement('p')
                blogsInfo.className = 'date'
                blogsInfo.innerText = ''

                let del = document.createElement('button')
                del.className = 'dell'
                del.innerText = 'delet'
                let updateBlog = document.createElement('button')
                updateBlog.className = 'update'
                updateBlog.innerText = 'update'


                ClosupdateBlog.onclick = function () {
                    editModal.style.display = "none";
                    document.body.style.backdropFilter = 'brightness(0.5)'

                }

                blogImgDiv.appendChild(blogsImg)
                blogsContainer.appendChild(blogsDescription)
                blogsContainer.appendChild(blogImgDiv)
                blogsContainer.appendChild(blogsInfo)
                blogs.appendChild(del)
                // del.onclick= delData()()
                del.addEventListener("click", delData);
                function delData() {
                    console.log(blog._id);
                    fetch(`http://localhost:3000/user/delBlog/${blog._id}`,
                        {
                            method: 'delete',

                        }).then(() => {
                            window.location.reload();
                        })
                }
                blogs.appendChild(updateBlog)
                blogs.appendChild(blogsTitleContainer)
                blogs.appendChild(blogsContainer)
                updateBlog.addEventListener('click', sendNewData);
                function sendNewData() {
                    console.log(blog._id);

                    editModal.style.display = "block";
                    event.preventDefault()
                    document.body.style.backdropFilter = 'blur(10px)'



                    // /**/*/*-
                    let editBlogButton = document.getElementById('bt')
                    editBlogButton.addEventListener('click', sub)
                    function sub() {
                        let image = document.getElementById('Blogimage')
                        let title = document.getElementById('title').value
                        let BlogBody = document.getElementById('blogbody').value
                        var file = image.files[0].name;
                        console.log(file);

                        fetch(`http://localhost:3000/user/updateBlog/${blog._id}`, {
                            method: 'put',
                            body: JSON.stringify({ title, BlogBody,file }),
                            // headers
                            headers: {
                                'Content-Type': 'application/json'

                            }
                        })
                        window.location.reload()
                    }
                }



            });
        })
    }



</script>

</html>